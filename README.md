# データセット分割ツール (Dataset Splitter)

機械学習のクラス分けに使用する画像データを、指定した比率で教師データと検証データに分割するツールです。

## 機能

- **階層ディレクトリ構造対応**: 大まかなクラス（例：鉄、非鉄）の中にサブクラス（例：223系、非鉄(食品)）がある構造を適切に処理
- ディレクトリ構造を保持したままデータを分割
- 各サブクラスディレクトリからランダムにファイルを選択
- 教師データと検証データの比率を指定可能
- 画像ファイル（jpg, jpeg, png, gif, bmp）を自動検出
- 指定した枚数以下のディレクトリは自動的にスキップ
- クロスプラットフォーム対応（Windows, macOS, Linux）

## 使用方法

### コマンドラインオプション

- `-source`: ソースディレクトリのパス
- `-dest`: 出力先ディレクトリのパス  
- `-ratio`: 教師データの比率 (0.0-1.0、デフォルト: 0.8)
- `-min-files`: コピーする最小ファイル数 (デフォルト: 50)
- `-tar`: 出力をtarファイルに圧縮（オプション）

### 基本的な使用方法

```bash
# 位置引数を使用
./dataset-splitter [ソースディレクトリ] [出力先ディレクトリ] [教師データ比率]

# フラグを使用
./dataset-splitter -source [ソースディレクトリ] -dest [出力先ディレクトリ] -ratio [教師データ比率] -min-files [最小ファイル数]
```

### 使用例

```bash
# 鉄道画像データを80%の教師データ、20%の検証データに分割
./dataset-splitter ./鉄道画像 ./output 0.8

# モノレール画像データを70%の教師データ、30%の検証データに分割
./dataset-splitter ./モノレール画像 ./monorail_output 0.7

# パーセンテージ表記も使用可能
./dataset-splitter ./交通機関画像 ./transport_output 75%

# 最小ファイル数を指定（30枚以下のディレクトリはスキップ）
./dataset-splitter -source ./鉄道画像 -dest ./output -min-files 30

# tarファイルで出力を圧縮
./dataset-splitter -source ./鉄道画像 -dest ./output -tar
```

## ディレクトリ構造の例

```
ソースディレクトリ/
├── 鉄/                      # 大まかなクラス
│   ├── 223系/              # サブクラス
│   ├── 313系/              # サブクラス
│   └── E231系/             # サブクラス
├── 非鉄/                    # 大まかなクラス
│   ├── 非鉄(食品)/          # サブクラス
│   ├── 非鉄(鳥類)/          # サブクラス
│   └── 非鉄(航空機)/        # サブクラス
├── 懸垂式モノレール/         # 大まかなクラス
│   ├── 上野懸垂線40系/      # サブクラス
│   ├── 千葉モノレール0形/   # サブクラス
│   └── 湘南モノレール5000系/ # サブクラス
└── 跨座式モノレール/         # 大まかなクラス
    ├── 東京モノレール1000形/ # サブクラス
    ├── 北九州モノレール1000形/ # サブクラス
    └── 東京モノレール2000形/ # サブクラス
```

## 出力構造

ツールは以下のような構造でデータを出力します：

```
出力先ディレクトリ/
├── train/                    # 教師データ
│   ├── 223系/               # サブクラス名でディレクトリ作成
│   ├── 313系/
│   ├── E231系/
│   ├── 非鉄(食品)/
│   ├── 非鉄(鳥類)/
│   ├── 上野懸垂線40系/
│   ├── 千葉モノレール0形/
│   ├── 東京モノレール1000形/
│   └── ...
└── validation/               # 検証データ
    ├── 223系/
    ├── 313系/
    ├── E231系/
    ├── 非鉄(食品)/
    ├── 非鉄(鳥類)/
    ├── 上野懸垂線40系/
    ├── 千葉モノレール0形/
    ├── 東京モノレール1000形/
    └── ...
```

**注意**: 大まかなクラス名（鉄、非鉄など）は出力に含まれず、サブクラス名のみが使用されます。

## ビルド方法

### macOS/Linux

```bash
# ビルドスクリプトを実行
chmod +x build.sh
./build.sh
```

### Windows

```cmd
# バッチファイルを実行
build.bat
```

### 手動ビルド

```bash
# 現在のプラットフォーム用
go build -o dataset-splitter .

# 特定のプラットフォーム用
GOOS=darwin GOARCH=amd64 go build -o dataset-splitter-mac-amd64 .
GOOS=windows GOARCH=amd64 go build -o dataset-splitter-windows-amd64.exe .
```

## 生成されるバイナリ

ビルド後、以下のバイナリが生成されます：

- `dataset-splitter-mac-amd64` - macOS (Intel)
- `dataset-splitter-mac-arm64` - macOS (Apple Silicon)
- `dataset-splitter-linux-amd64` - Linux (Intel)
- `dataset-splitter-linux-arm64` - Linux (ARM)
- `dataset-splitter-windows-amd64.exe` - Windows (Intel)
- `dataset-splitter-windows-arm64.exe` - Windows (ARM)

## 注意事項

- ソースディレクトリ内の各サブディレクトリが1つのクラスとして扱われます
- 画像ファイル以外のファイルは無視されます
- 指定した最小ファイル数未満のディレクトリは自動的にスキップされます（デフォルト: 50枚）
- 既存の出力ディレクトリがある場合、上書きされます
- ファイルのコピーに失敗した場合は警告が表示されますが、処理は継続されます

## ライセンス

このツールはGNU General Public License v3.0 (GPL v3) の下で公開されています。

詳細は [LICENSE](LICENSE) ファイルを参照してください。
